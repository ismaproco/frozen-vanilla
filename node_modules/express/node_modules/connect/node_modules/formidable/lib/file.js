if (global.GENTLY) require = GENTLY.hijack(require);

<<<<<<< HEAD
var util = require('util'),
=======
var util = require('./util'),
>>>>>>> 37bc3d31dc01e2ffb149a7cf29dc44a6357559de
    WriteStream = require('fs').WriteStream,
    EventEmitter = require('events').EventEmitter,
    crypto = require('crypto');

function File(properties) {
  EventEmitter.call(this);

  this.size = 0;
  this.path = null;
  this.name = null;
  this.type = null;
  this.hash = null;
  this.lastModifiedDate = null;

  this._writeStream = null;
  
  for (var key in properties) {
    this[key] = properties[key];
  }

  if(typeof this.hash === 'string') {
    this.hash = crypto.createHash(properties.hash);
<<<<<<< HEAD
  } else {
    this.hash = null;
  }
=======
  }

  this._backwardsCompatibility();
>>>>>>> 37bc3d31dc01e2ffb149a7cf29dc44a6357559de
}
module.exports = File;
util.inherits(File, EventEmitter);

<<<<<<< HEAD
File.prototype.open = function() {
  this._writeStream = new WriteStream(this.path);
};

File.prototype.toJSON = function() {
  return {
    size: this.size,
    path: this.path,
    name: this.name,
    type: this.type,
    mtime: this.lastModifiedDate,
    length: this.length,
    filename: this.filename,
    mime: this.mime
  };
=======
// @todo Next release: Show error messages when accessing these
File.prototype._backwardsCompatibility = function() {
  var self = this;
  this.__defineGetter__('length', function() {
    return self.size;
  });
  this.__defineGetter__('filename', function() {
    return self.name;
  });
  this.__defineGetter__('mime', function() {
    return self.type;
  });
};

File.prototype.open = function() {
  this._writeStream = new WriteStream(this.path);
>>>>>>> 37bc3d31dc01e2ffb149a7cf29dc44a6357559de
};

File.prototype.write = function(buffer, cb) {
  var self = this;
<<<<<<< HEAD
  if (self.hash) {
    self.hash.update(buffer);
  }
  this._writeStream.write(buffer, function() {
=======
  this._writeStream.write(buffer, function() {
    if(self.hash) {
      self.hash.update(buffer);
    }
>>>>>>> 37bc3d31dc01e2ffb149a7cf29dc44a6357559de
    self.lastModifiedDate = new Date();
    self.size += buffer.length;
    self.emit('progress', self.size);
    cb();
  });
};

File.prototype.end = function(cb) {
  var self = this;
<<<<<<< HEAD
  if (self.hash) {
    self.hash = self.hash.digest('hex');
  }
  this._writeStream.end(function() {
=======
  this._writeStream.end(function() {
    if(self.hash) {
      self.hash = self.hash.digest('hex');
    }
>>>>>>> 37bc3d31dc01e2ffb149a7cf29dc44a6357559de
    self.emit('end');
    cb();
  });
};
